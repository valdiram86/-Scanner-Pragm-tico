<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Pragm√°tico Scanner</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    h1 { color: #333; }
    .top-moedas { margin-bottom: 30px; background: #fff; padding: 15px; border-radius: 5px; }
    table.dataTable th, table.dataTable td { white-space: nowrap; }
    .tabela-container { margin-bottom: 50px; }
  </style>
</head>
<body>

  <h1>üîç Scanner Pragm√°tico ‚Äî CoinMarketCap</h1>
  <p><a href="https://script.google.com/macros/s/AKfycbx5SzHPXb16HYdTVt_BMOAdcP5Dy21JbC1EiOyc4IsiQPMXV6SumyVgTreySF-3Z46rIg/exec" target="_blank">Abrir JSON direto</a></p>

  <div class="top-moedas" id="top10Moedas">
    <h2>üî• Top 1 por aba</h2>
    <ul id="listaTop10"></ul>
  </div>

  <div id="tabelasContainer"></div>

<script>
  const abas = [
    'TopPerdedoras_1_100', 'TopPerdedoras_101_200', 'TopPerdedoras_201_300',
    'TopPerdedoras_301_400', 'TopPerdedoras_401_500', 'TopPerdedoras_501_750',
    'TopPerdedoras_751_1000', 'TopPerdedoras_1001_1250', 'TopPerdedoras_1251_1500',
    'TopVolumePragmatico'
  ];

  const API_URL = 'https://script.google.com/macros/s/AKfycbx5SzHPXb16HYdTVt_BMOAdcP5Dy21JbC1EiOyc4IsiQPMXV6SumyVgTreySF-3Z46rIg/exec';

  $(document).ready(async function () {
    const topMoedas = [];

    for (const aba of abas) {
      const response = await fetch(`${API_URL}?aba=${aba}`);
      const data = await response.json();
      const valores = data.dados;
      if (valores.length < 2) continue;

      const headers = valores[1];
      const linhas = valores.slice(2);
      const idTabela = `tabela_${aba}`;

      let html = `<div class="tabela-container"><h2>${aba}</h2>`;
      html += `<table id="${idTabela}" class="display" style="width:100%"><thead><tr>`;

      headers.forEach(header => html += `<th>${header}</th>`);
      html += `</tr></thead><tbody>`;

      linhas.forEach(linha => {
        html += `<tr>`;
        linha.forEach(cel => {
          let celula = cel;
          if (typeof cel === 'string' && cel.startsWith('http')) {
            celula = `<a href="${cel}" target="_blank">üîó</a>`;
          }
          html += `<td>${celula}</td>`;
        });
        html += `</tr>`;
      });

      html += `</tbody></table></div>`;
      $('#tabelasContainer').append(html);

      $(`#${idTabela}`).DataTable({
        pageLength: 5,
        lengthChange: false,
        order: [],
        language: {
          search: "üîé Filtrar:",
          paginate: {
            first: "¬´",
            previous: "‚Äπ",
            next: "‚Ä∫",
            last: "¬ª"
          },
          info: "Exibindo _START_ a _END_ de _TOTAL_ entradas"
        }
      });

      // Coletar top moeda da aba
      const topMoeda = linhas[0];
      if (topMoeda && topMoeda.length >= 3) {
        topMoedas.push(`<li><strong>${aba}:</strong> <a href="${topMoeda[2]}" target="_blank">${topMoeda[0]}</a></li>`);
      }
    }

    $('#listaTop10').html(topMoedas.join(''));
  });
</script>
</body>
</html>
