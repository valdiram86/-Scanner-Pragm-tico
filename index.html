<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel PragmÃ¡tico</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #333;
    }

    #abaSelect {
      display: block;
      margin: 20px auto;
      padding: 10px;
      font-size: 16px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      text-align: left;
    }

    th {
      background-color: #ddd;
      cursor: pointer;
    }

    tr:hover {
      background-color: #f0f0f0;
    }

    .link {
      color: #0073e6;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <h1>Painel PragmÃ¡tico ðŸ“‰ðŸ“ˆ</h1>

  <select id="abaSelect">
    <option value="TopPerdedoras_1_100">Top Perdedoras 1â€“100</option>
    <option value="TopPerdedoras_101_200">Top Perdedoras 101â€“200</option>
    <option value="TopPerdedoras_201_300">Top Perdedoras 201â€“300</option>
    <option value="TopPerdedoras_301_400">Top Perdedoras 301â€“400</option>
    <option value="TopPerdedoras_401_500">Top Perdedoras 401â€“500</option>
    <option value="TopPerdedoras_501_750">Top Perdedoras 501â€“750</option>
    <option value="TopPerdedoras_751_1000">Top Perdedoras 751â€“1000</option>
    <option value="TopPerdedoras_1001_1250">Top Perdedoras 1001â€“1250</option>
    <option value="TopPerdedoras_1251_1500">Top Perdedoras 1251â€“1500</option>
    <option value="TopVolumePragmatico">Top Volume PragmÃ¡tico</option>
  </select>

  <div id="tabelaContainer"></div>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbx5SzHPXb16HYdTVt_BMOAdcP5Dy21JbC1EiOyc4IsiQPMXV6SumyVgTreySF-3Z46rIg/exec';
    const abaSelect = document.getElementById('abaSelect');
    const tabelaContainer = document.getElementById('tabelaContainer');

    let dadosAtuais = [];

    function carregarAba(nomeAba) {
      fetch(`${API_URL}?aba=${encodeURIComponent(nomeAba)}`)
        .then(res => res.json())
        .then(data => {
          dadosAtuais = data.dados;
          renderizarTabela(dadosAtuais);
        })
        .catch(err => {
          console.error(err);
          tabelaContainer.innerHTML = '<p>Erro ao carregar dados.</p>';
        });
    }

    function renderizarTabela(dados) {
      if (!dados || dados.length === 0) {
        tabelaContainer.innerHTML = '<p>Nenhum dado disponÃ­vel.</p>';
        return;
      }

      let html = '<table id="tabela"><thead><tr>';
      dados[0].forEach((cab, idx) => {
        html += `<th onclick="ordenarPorColuna(${idx})">${cab} ðŸ”½</th>`;
      });
      html += '</tr></thead><tbody>';

      for (let i = 1; i < dados.length; i++) {
        html += '<tr>';
        dados[i].forEach(valor => {
          const v = String(valor);
          const cell = v.startsWith('http')
            ? `<a class="link" href="${v}" target="_blank">ðŸ”— Link</a>`
            : v;
          html += `<td>${cell}</td>`;
        });
        html += '</tr>';
      }

      html += '</tbody></table>';
      tabelaContainer.innerHTML = html;
    }

    function ordenarPorColuna(colIndex) {
      const header = dadosAtuais[0];
      const corpo = dadosAtuais.slice(1);

      const colunaNumerica = corpo.every(linha => !isNaN(parseFloat(linha[colIndex])));

      corpo.sort((a, b) => {
        const valA = a[colIndex];
        const valB = b[colIndex];

        if (colunaNumerica) {
          return parseFloat(valB) - parseFloat(valA); // Descendente
        } else {
          return String(valA).localeCompare(String(valB));
        }
      });

      dadosAtuais = [header, ...corpo];
      renderizarTabela(dadosAtuais);
    }

    abaSelect.addEventListener('change', () => {
      carregarAba(abaSelect.value);
    });

    carregarAba(abaSelect.value);
  </script>
</body>
</html>
